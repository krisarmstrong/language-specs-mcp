ShellCheck: SC2315 – In bats, `!` does not cause a test failure. Fold the `!` into the conditional!

# SC2315 – ShellCheck Wiki

[See this page on GitHub](https://github.com/koalaman/shellcheck/wiki/SC2315)

[Sitemap](index.html)

## In bats, `!` does not cause a test failure. Fold the `!` into the conditional!

### Problematic code:

```
#cb1-1#!/usr/bin/env bats
#cb1-2
#cb1-3@test "test" {
#cb1-4    # ... code
#cb1-5    ! [ $status == 0 ]
#cb1-6    # ... more code
#cb1-7}
```

### Correct code:

```
#cb2-1#!/usr/bin/env bats
#cb2-2
#cb2-3@test "test" {
#cb2-4    # ... code
#cb2-5    [ $status != 0 ]
#cb2-6    # ... more code
#cb2-7}
```

### Rationale:

Bats uses `set -e` and `trap ERR` to catch test failures as early as possible. Although the return code of a `!` negated command is inverted, they will never trigger `errexit`, due to a bash design decision (see [Related Resources](#related-resources)). This means that tests which use `!` can never fail.

### Exceptions:

The return code of the last command in the test will be the exit code of the test function. This means that you can use `! <command>` on the last line of the test and it will still fail appropriately. However, you are encouraged to still transform the code in this case for consistency.

### Related resources:

- 

[SC2314: In bats, ! does not cause a test failure
(for non-conditionals)](SC2314)

- 

[SC2251: This ! is not on a condition and
skips errexit](SC2251.md)

- 

[Stackoverflow: Why do
I need parenthesis In bash set -e and negated return
code](https://stackoverflow.com/a/39582012/760746)

- 

[bash manpage](https://linux.die.net/man/1/bash) (look at `trap [-lp] [[arg] sigspec ...]`):

The ERR trap is not executed [...] if the command's return value is being inverted via !

[ShellCheck](https://www.shellcheck.net) is a static analysis tool for shell scripts. This page is part of its documentation.
