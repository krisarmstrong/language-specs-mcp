ShellCheck: SC3015 – In POSIX sh, `=~` regex matching is undefined.

# SC3015 – ShellCheck Wiki

[See this page on GitHub](https://github.com/koalaman/shellcheck/wiki/SC3015)

[Sitemap](index.html)

## In POSIX sh, `=~` regex matching is undefined.

### Problematic code:

```
#cb1-1#!/bin/sh
#cb1-2if [ "$var" =~ foo[0-9]+ ]; then
#cb1-3  echo matched
#cb1-4fi
```

### Correct code:

```
#cb2-1#!/bin/sh
#cb2-2# Use the x-hack to handle strings like '('.
#cb2-3if expr "X$var" : 'X.*foo[0-9]\{1,\}' >/dev/null; then
#cb2-4  echo matched
#cb2-5fi
```

or

```
#cb3-1#!/bin/sh
#cb3-2case $var in
#cb3-3  *foo[0-9]*)
#cb3-4    echo matched
#cb3-5    ;;
#cb3-6esac
```

### Rationale:

You are using `=~` in a script declared to be compatible with POSIX sh or Dash, but `=~` is [not
specified by POSIX](https://pubs.opengroup.org/onlinepubs/9699919799/utilities/test.html) and is unlikely to work outside `[[ ]]` in Bash and Ksh.

Use [expr's
: operator](https://pubs.opengroup.org/onlinepubs/9699919799/utilities/expr.html#tag_20_42_13_01) instead. It may be necessary to revise the regular expression because POSIX `expr` uses [basic
regular expressions](https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap09.html#tag_09_03) anchored to the beginning of the string, as opposed to the unanchored [extended
regular expressions](https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap09.html#tag_09_04) used by `[[ str =~ re ]]` in Bash and Ksh.

Alternately, use `case` if the matching can be done with [shell
patterns](https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_13) instead of regular expressions. This avoids the need for an external utility.

### Exceptions:

None

### Related resources:

- [Greg's Wiki -
BashFAQ #41: How do I determine whether a variable contains a
substring?](https://mywiki.wooledge.org/BashFAQ/041)

[ShellCheck](https://www.shellcheck.net) is a static analysis tool for shell scripts. This page is part of its documentation.
