ShellCheck: SC2298 – `${$x}` is invalid. For expansion, use ${x}. For indirection, use arrays, ${!x} or (for sh) eval.

# SC2298 – ShellCheck Wiki

[See this page on GitHub](https://github.com/koalaman/shellcheck/wiki/SC2298)

[Sitemap](index.html)

## `${$x}` is invalid. For expansion, use ${x}. For indirection, use arrays, ${!x} or (for sh) eval.

(or `${${x}}` is invalid)

### Problematic code:

```
#cb1-1# Expecting $RETRIES or 3 if unset
#cb1-2retries=${$RETRIES:-3}
```

or

```
#cb2-1mypath="/tmp/foo.txt"
#cb2-2var=mypath
#cb2-3result=${$var##*/}  # Expecting ${mypath##*/}, i.e. 'foo.txt'
```

### Correct code:

```
#cb3-1retries=${RETRIES:-3}
```

or

```
#cb4-1mypath="/tmp/foo.txt"
#cb4-2var=mypath
#cb4-3result=${!var}
#cb4-4result=${result##*/}
```

### Rationale:

ShellCheck found a parameter expansion `${..}` where the first element was a second parameter expansion, either `${$x..}` or `${${x}..}`. This is not valid.

In the first example, the extra `$` was unintentional and should simply be deleted.

In the second example, `${$var##*/}` was used in the hopes that it would expand to `${myvar##*/}` and subsequently strip the path. This is not possible, and `var` must instead be expanded indirectly in a separate step, before the path can be stripped as usual. More information and other approaches can be found in the description of [SC2082](SC2082).

### Exceptions:

None

### Related resources:

- Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!

[ShellCheck](https://www.shellcheck.net) is a static analysis tool for shell scripts. This page is part of its documentation.
