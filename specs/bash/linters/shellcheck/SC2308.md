ShellCheck: SC2308 – `expr length` has unspecified results. Prefer `${#var}`.

# SC2308 – ShellCheck Wiki

[See this page on GitHub](https://github.com/koalaman/shellcheck/wiki/SC2308)

[Sitemap](index.html)

## `expr length` has unspecified results. Prefer `${#var}`.

or `'expr match' has unspecified results. Prefer 'expr str : regex'.`
 or `'expr substr' has unspecified results. Prefer 'cut' or ${var#???}.`
 or `'expr index' has unspecified results. Prefer x=${var%%[chars]*}; $((${#x}+1)).`

### Problematic code:

```
#cb1-1# Find length of string
#cb1-2length=$(expr length "$var")
#cb1-3
#cb1-4# Match string against regex
#cb1-5expr match "$input" "[0-9]*"
#cb1-6
#cb1-7# Find character index in string
#cb1-8pos=$(expr index "$input" ":")
#cb1-9
#cb1-10# Get substring by index
#cb1-11col2=$(expr substr "foo    bar  baz" 8 5)
```

### Correct code:

```
#cb2-1# Find length of string
#cb2-2length=${#var}
#cb2-3
#cb2-4# Match string against regex
#cb2-5expr "$input" : "[0-9]*"
#cb2-6
#cb2-7# Find character index in string
#cb2-8pos=${input%%:*} pos=$((${#pos}+1))
#cb2-9
#cb2-10# Get substring by index (bash)
#cb2-11str="foo    bar  baz"
#cb2-12col2="${str:7:5}"
#cb2-13
#cb2-14# Get substring by index (POSIX)
#cb2-15col2="$(printf 'foo    bar  baz\n' | cut -c 8-12)"
```

### Rationale:

You are using a `expr` with `length`, `match`, `index`, or `substr`. These forms did not make it into POSIX, and fail on platforms like MacOS and FreeBSD. Consider replacing them with portable equivalents:

#### `length`

can be trivially replaced with `${#var}`

#### `match`

can be trivially replaced with the POSIX form `expr str : regex`

#### `index`

if you only need a numerical index as part of trying to extract a piece of the string, consider replacing it with parameter expansion:

```
#cb3-1str="mykey=myvalue"
#cb3-2key="${str%%=*}"    # Remove everything after first =, no index required
#cb3-3value="${str#*=}"   # Remove everything before first =, no index required
```

otherwise, you can find the index of the first `=` using parameter expansion and string length:

```
#cb4-1str="mykey=myvalue"
#cb4-2x=${str%%=*}     # Assign x="mystr"
#cb4-3index=$((${#x}+1))   # Add 1 to length of x
```

#### `substr`

Extract a substring via character index is generally fragile. For example, in this example, any minor changes to the format, including just the version increasing from 8.9 to 8.10, will cause the following snippet to fail:

```
#cb5-1str="VIM - Vi IMproved 8.2 (2019 Dec 12, compiled Feb 15 2021 12:29:39)"
#cb5-2version=$(expr substr "$str" 19 3)
```

Instead, consider a different approach:

```
#cb6-1x="${str%% (*}"     # Delete ` (` and everything after, giving "VIM - Vi IMproved 8.2"
#cb6-2version="${x##* }"  # Delete everything before last space, giving "8.2"
#cb6-3
#cb6-4# Get the fifth word separated by spaces
#cb6-5IFS=" " read -r _ _ _ _ version _ << EOF
#cb6-6$str
#cb6-7EOF
```

If you still want to use character index, this is trivially done in Bash/Ksh with `${var:offset:length}` (0-based).

In POSIX, you can generally use `cut`, though be careful if the value can contain multiple lines.

### Exceptions:

If you know your script will only run on platforms where these forms are supported, like GNU or BusyBox, you can [ignore](ignore) this warning.

### Related resources:

- Help by adding links to BashFAQ, StackOverflow, man pages, POSIX, etc!

[ShellCheck](https://www.shellcheck.net) is a static analysis tool for shell scripts. This page is part of its documentation.
