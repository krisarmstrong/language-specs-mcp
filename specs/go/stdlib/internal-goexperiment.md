cmd/go: add GOEXPERIMENT=cacheprog to let a child process implement the internal action/output cache ¬∑ Issue #59719 ¬∑ golang/go ¬∑ GitHub[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation/[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fissues%2F59719)Appearance settings

- Platform

  - AI CODE CREATION

    - [GitHub CopilotWrite better code with AI](https://github.com/features/copilot)
    - [GitHub SparkBuild and deploy intelligent apps](https://github.com/features/spark)
    - [GitHub ModelsManage and compare prompts](https://github.com/features/models)
    - [MCP RegistryNewIntegrate external tools](https://github.com/mcp)

  - DEVELOPER WORKFLOWS

    - [ActionsAutomate any workflow](https://github.com/features/actions)
    - [CodespacesInstant dev environments](https://github.com/features/codespaces)
    - [IssuesPlan and track work](https://github.com/features/issues)
    - [Code ReviewManage code changes](https://github.com/features/code-review)

  - APPLICATION SECURITY

    - [GitHub Advanced SecurityFind and fix vulnerabilities](https://github.com/security/advanced-security)
    - [Code securitySecure your code as you build](https://github.com/security/advanced-security/code-security)
    - [Secret protectionStop leaks before they start](https://github.com/security/advanced-security/secret-protection)

  - EXPLORE

    - [Why GitHub](https://github.com/why-github)
    - [Documentation](https://docs.github.com)
    - [Blog](https://github.blog)
    - [Changelog](https://github.blog/changelog)
    - [Marketplace](https://github.com/marketplace)

[View all features](https://github.com/features)
- Solutions

  - BY COMPANY SIZE

    - [Enterprises](https://github.com/enterprise)
    - [Small and medium teams](https://github.com/team)
    - [Startups](https://github.com/enterprise/startups)
    - [Nonprofits](https://github.com/solutions/industry/nonprofits)

  - BY USE CASE

    - [App Modernization](https://github.com/solutions/use-case/app-modernization)
    - [DevSecOps](https://github.com/solutions/use-case/devsecops)
    - [DevOps](https://github.com/solutions/use-case/devops)
    - [CI/CD](https://github.com/solutions/use-case/ci-cd)
    - [View all use cases](https://github.com/solutions/use-case)

  - BY INDUSTRY

    - [Healthcare](https://github.com/solutions/industry/healthcare)
    - [Financial services](https://github.com/solutions/industry/financial-services)
    - [Manufacturing](https://github.com/solutions/industry/manufacturing)
    - [Government](https://github.com/solutions/industry/government)
    - [View all industries](https://github.com/solutions/industry)

[View all solutions](https://github.com/solutions)
- Resources

  - EXPLORE BY TOPIC

    - [AI](https://github.com/resources/articles?topic=ai)
    - [Software Development](https://github.com/resources/articles?topic=software-development)
    - [DevOps](https://github.com/resources/articles?topic=devops)
    - [Security](https://github.com/resources/articles?topic=security)
    - [View all topics](https://github.com/resources/articles)

  - EXPLORE BY TYPE

    - [Customer stories](https://github.com/customer-stories)
    - [Events & webinars](https://github.com/resources/events)
    - [Ebooks & reports](https://github.com/resources/whitepapers)
    - [Business insights](https://github.com/solutions/executive-insights)
    - [GitHub Skills](https://skills.github.com)

  - SUPPORT & SERVICES

    - [Documentation](https://docs.github.com)
    - [Customer support](https://support.github.com)
    - [Community forum](https://github.com/orgs/community/discussions)
    - [Trust center](https://github.com/trust-center)
    - [Partners](https://github.com/partners)

- Open Source

  - COMMUNITY

    - [GitHub SponsorsFund open source developers](https://github.com/sponsors)

  - PROGRAMS

    - [Security Lab](https://securitylab.github.com)
    - [Maintainer Community](https://maintainers.github.com)
    - [Accelerator](https://github.com/accelerator)
    - [Archive Program](https://archiveprogram.github.com)

  - REPOSITORIES

    - [Topics](https://github.com/topics)
    - [Trending](https://github.com/trending)
    - [Collections](https://github.com/collections)

- Enterprise

  - ENTERPRISE SOLUTIONS

    - [Enterprise platformAI-powered developer platform](https://github.com/enterprise)

  - AVAILABLE ADD-ONS

    - [GitHub Advanced SecurityEnterprise-grade security features](https://github.com/security/advanced-security)
    - [Copilot for BusinessEnterprise-grade AI features](https://github.com/features/copilot/copilot-business)
    - [Premium SupportEnterprise-grade 24/7 support](https://github.com/premium-support)

- [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

 Search Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

#  Provide feedback 

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted Cancel  Submit feedback 

#  Saved searches 

## Use saved searches to filter your results more quickly

NameQuery

 To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax). 

 Cancel  Create saved search [Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fissues%2F59719)[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=golang%2Fgo)Appearance settingsResetting focusYou signed in with another tab or window. Reload to refresh your session.You signed out in another tab or window. Reload to refresh your session.You switched accounts on another tab or window. Reload to refresh your session.Dismiss alert{{ message }}[golang](/golang)/[go](/golang/go)Public

- [Notifications](/login?return_to=%2Fgolang%2Fgo)You must be signed in to change notification settings
- [Fork
    18.7k](/login?return_to=%2Fgolang%2Fgo)
- [Star
          132k](/login?return_to=%2Fgolang%2Fgo)

- [Code](/golang/go)
- [Issues
          5k+](/golang/go/issues)
- [Pull requests
          366](/golang/go/pulls)
- [Discussions](/golang/go/discussions)
- [Actions](/golang/go/actions)
- [Projects
          5](/golang/go/projects)
- [Wiki](/golang/go/wiki)
- 

### 

[Security
          
  
  
    
  
    
      

              Uh oh!

              There was an error while loading. Please reload this page](/golang/go/security).

- [Insights](/golang/go/pulse)

Additional navigation options

- [Code](/golang/go)
- [Issues](/golang/go/issues)
- [Pull requests](/golang/go/pulls)
- [Discussions](/golang/go/discussions)
- [Actions](/golang/go/actions)
- [Projects](/golang/go/projects)
- [Wiki](/golang/go/wiki)
- [Security](/golang/go/security)
- [Insights](/golang/go/pulse)

# cmd/go: add GOEXPERIMENT=cacheprog to let a child process implement the internal action/output cache#59719

[New issue](/login?return_to=)Copy link[New issue](/login?return_to=)Copy linkClosedClosed[cmd/go: add GOEXPERIMENT=cacheprog to let a child process implement the internal action/output cache](#top)#59719Copy linkLabels[FrozenDueToAge](https://github.com/golang/go/issues?q=state%3Aopen%20label%3A%22FrozenDueToAge%22)[GoCommandcmd/go](https://github.com/golang/go/issues?q=state%3Aopen%20label%3A%22GoCommand%22)cmd/go[Proposal](https://github.com/golang/go/issues?q=state%3Aopen%20label%3A%22Proposal%22)[Proposal-Accepted](https://github.com/golang/go/issues?q=state%3Aopen%20label%3A%22Proposal-Accepted%22)Milestone[Go1.21](https://github.com/golang/go/milestone/279)https://github.com/bradfitz

## Description

https://github.com/bradfitz[bradfitz](https://github.com/bradfitz)opened [on Apr 19, 2023](https://github.com/golang/go/issues/59719#issue-1675576689)Issue body actions

The `cmd/go` tool has great caching support. Unfortunately, its caching only supports filesystem-based caching.

I'd like to do things like hook into GitHub's native caching system at a lower level (instead of the inefficient thing people do now: untarring/tarring GOCACHE archives on every CI run, which is often slower than the CI action itself) and support things like a P2P cache gossip protocol between [trusted] coworkers within a company.

Clearly both those examples aren't realistic to add to `cmd/go` itself. So instead:

I propose that `cmd/go` support a `GOCACHEPROG=/path/to/program` environment variable (akin to `GOCACHE=/path/to/dir`) where the GOCACHEPROG is run as a child process and `cmd/go` speaks to it over stdin/stdout, translating the Go tool's internal cache interface, and then the GOCACHEPROG can do whatever caching mechanism/policy it wants.

I talked to [@rsc](https://github.com/rsc) about this once and he didn't seem opposed so I went off and [implemented it](https://go.dev/cl/486715) and it's looking like it's going to be pretty awesome. ([demo programs](https://github.com/bradfitz/go-tool-cache))

Thoughts, objections, etc?

(And preemptively: I have a soft spot for FUSE but FUSE is not an answer; it doesn't work in enough environments like CI test runner environments and it's finicky on basically all platforms but Linux, but also on Linux)

The protocol (from the code linked above) is currently:

```
// ProgCmd is a command that can be issued to a child process.
//
// If the interface needs to grow, we can add new commands or new versioned
// commands like "get2".
type ProgCmd string

const (
	cmdGet   = ProgCmd("get")
	cmdPut   = ProgCmd("put")
	cmdClose = ProgCmd("close")
)

// ProgRequest is the JSON-encoded message that's sent from cmd/go to
// the GOCACHEPROG child process over stdin. Each JSON object is on its
// own line. A ProgRequest of Type "put" with BodySize > 0 will be followed
// by a line containing a base64-encoded JSON string literal of the body.
type ProgRequest struct {
	// ID is a unique number per process across all requests.
	// It must be echoed in the ProgResponse from the child.
	ID int64

	// Command is the type of request.
	// The cmd/go tool will only send commands that were declared
	// as supported by the child.
	Command ProgCmd

	// ActionID is non-nil for get and puts.
	ActionID []byte `json:",omitempty"` // or nil if not used

	// ObjectID is set for Type "put" and "output-file".
	ObjectID []byte `json:",omitempty"` // or nil if not used

	// Body is the body for "put" requests. It's sent after the JSON object
	// as a base64-encoded JSON string when BodySize is non-zero.
	// It's sent as a separate JSON value instead of being a struct field
	// send in this JSON object so large values can be streamed in both directions.
	// The base64 string body of a ProgRequest will always be written
	// immediately after the JSON object and a newline.
	Body io.Reader `json:"-"`

	// BodySize is the number of bytes of Body. If zero, the body isn't written.
	BodySize int64 `json:",omitempty"`
}

// ProgResponse is the JSON response from the child process to cmd/go.
//
// With the exception of the first protocol message that the child writes to its
// stdout with ID==0 and KnownCommands populated, these are only sent in
// response to a ProgRequest from cmd/go.
//
// ProgResponses can be sent in any order. The ID must match the request they're
// replying to.
type ProgResponse struct {
	ID  int64  // that corresponds to ProgRequest; they can be answered out of order
	Err string `json:",omitempty"` // if non-empty, the error

	// KnownCommands is included in the first message that cache helper program
	// writes to stdout on startup (with ID==0). It includes the
	// ProgRequest.Command types that are supported by the program.
	//
	// This lets us extend the gracefully over time (adding "get2", etc), or
	// fail gracefully when needed. It also lets us verify the program
	// wants to be a cache helper.
	KnownCommands []ProgCmd `json:",omitempty"`

	// For Get requests.

	Miss      bool   `json:",omitempty"` // cache miss
	OutputID  []byte `json:",omitempty"`
	Size      int64  `json:",omitempty"`
	TimeNanos int64  `json:",omitempty"` // TODO(bradfitz): document

	// DiskPath is the absolute path on disk of the ObjectID corresponding
	// a "get" request's ActionID (on cache hit) or a "put" request's
	// provided ObjectID.
	DiskPath string `json:",omitempty"`
}
```

üëçReact with üëç36DeedleFake, itstarsun, bcmills, dany74q, ericlagergren and 31 more

## Metadata

## Metadata

### Assignees

No one assigned

### Labels

[FrozenDueToAge](https://github.com/golang/go/issues?q=state%3Aopen%20label%3A%22FrozenDueToAge%22)[GoCommandcmd/go](https://github.com/golang/go/issues?q=state%3Aopen%20label%3A%22GoCommand%22)cmd/go[Proposal](https://github.com/golang/go/issues?q=state%3Aopen%20label%3A%22Proposal%22)[Proposal-Accepted](https://github.com/golang/go/issues?q=state%3Aopen%20label%3A%22Proposal-Accepted%22)

### Type

No type

### Projects

No projects

### Milestone

- [Go1.21](https://github.com/golang/go/milestone/279)

### Relationships

None yet

### Development

No branches or pull requests

## Issue actions

## Footer

https://github.com ¬© 2026 GitHub, Inc. 

### Footer navigation

- [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
- [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
- [Security](https://github.com/security)
- [Status](https://www.githubstatus.com/)
- [Community](https://github.community/)
- [Docs](https://docs.github.com/)
- [Contact](https://support.github.com?tags=dotcom-footer)
-  Manage cookies 
-  Do not share my personal information 

 You can‚Äôt perform that action at this time.
